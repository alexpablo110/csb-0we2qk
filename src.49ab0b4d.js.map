{"version":3,"sources":["src/index.js"],"names":["inputElement","document","getElementById","form","allCats","allAssignments","products","handleUploadedFile","event","innerHTML","preventDefault","pageIDs","value","trim","split","map","pageID","library","files","length","fileName","name","classList","add","getXMLDoc","then","xml","XMLDocument","getPDAssets","addMessage","inputFile","fileReader","FileReader","Promise","resolve","reject","onerror","abort","DOMException","onload","fileText","result","xmlDoc","DOMParser","parseFromString","readAsText","getAsset","id","xpath","evaluate","nodes","XPathResult","ANY_TYPE","nextElement","iterateNext","window","ActiveXObject","setProperty","selectNodes","evaluateXpath","push","getAssignments","category","getCategoryID","assignments","concat","element","getAttribute","getParent","parent","getElementsByTagName","Array","from","getRecords","productId","records","filter","rec","getRelatedAssets","asset","categoryId","cat","libraryNode","remove","cloneNode","pageFound","forEach","root","assets","pop","appendChild","createTextNode","download","outerHTML","filename","text","createElement","setAttribute","encodeURIComponent","style","display","body","click","removeChild","message","type","cssClass","notification","addEventListener"],"mappings":"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","file":"src.49ab0b4d.js","sourceRoot":"..","sourcesContent":["import \"./styles.css\";\n\nconst inputElement = document.getElementById(\"library-input\");\nconst form = document.getElementById(\"form-pd\");\nvar allCats = [];\nvar allAssignments = [];\nvar products = [];\nform.addEventListener(\"submit\", handleUploadedFile, false);\n\nfunction handleUploadedFile(event) {\n  document.getElementById(\"info-messages\").innerHTML = \"\";\n  event.preventDefault();\n  const textArea = document.getElementById(\"pageids-textarea\");\n  const pageIDs = textArea.value\n    .trim()\n    .split(\",\")\n    .map((pageID) => {\n      return pageID.trim();\n    });\n  const library =\n    inputElement.files && inputElement.files.length && inputElement.files[0];\n  const fileName = library.name;\n  document.getElementById(\"app\").classList.add(\"loading\");\n  getXMLDoc(library).then((xml) => {\n    if (xml && xml instanceof XMLDocument) {\n      getPDAssets(pageIDs, xml, fileName);\n    } else {\n      addMessage(`File \"${fileName}\" can not be parsed.`, \"error\");\n    }\n  });\n}\n\nfunction getXMLDoc(inputFile) {\n  const fileReader = new FileReader();\n  return new Promise((resolve, reject) => {\n    fileReader.onerror = () => {\n      fileReader.abort();\n      reject(new DOMException(\"Problem parsing input file.\"));\n    };\n    fileReader.onload = () => {\n      var fileText = fileReader.result;\n      var parser = new DOMParser();\n      var xmlDoc = parser.parseFromString(fileText, \"text/xml\");\n      resolve(xmlDoc);\n    };\n    fileReader.readAsText(inputFile);\n  });\n}\n\nfunction getAsset(id, xml) {\n  var xpath = `/*[local-name()='price-table'][@product-id=\"${id}\"]`;\n  var result;\n  if (xml.evaluate) {\n    var nodes = xml.evaluate(xpath, xml, null, XPathResult.ANY_TYPE, null);\n    var nextElement = nodes.iterateNext();\n    while (nextElement) {\n      result = nextElement;\n      nextElement = nodes.iterateNext();\n    }\n  } else if (window.ActiveXObject) {\n    xml.setProperty(\"SelectionLanguage\", \"XPath\");\n    nodes = xml.selectNodes(xpath);\n    result = nodes && nodes[0];\n  }\n  return result;\n}\n\nfunction evaluateXpath(xpath, xml) {\n  var result = [];\n  if (xml.evaluate) {\n    var nodes = xml.evaluate(xpath, xml, null, XPathResult.ANY_TYPE, null);\n    var nextElement = nodes.iterateNext();\n    while (nextElement) {\n      result.push(nextElement);\n      nextElement = nodes.iterateNext();\n    }\n  } else if (window.ActiveXObject) {\n    xml.setProperty(\"SelectionLanguage\", \"XPath\");\n    nodes = xml.selectNodes(xpath);\n    result = nodes;\n  }\n  return result;\n}\n\nfunction getAssignments(category, xml) {\n  var id = getCategoryID(category);\n  var xpath = `/*[local-name()='catalog']/*[local-name()='category-assignment'][@category-id=\"${id}\"]`;\n  var assignments = evaluateXpath(xpath, xml);\n  products = products.concat(\n    assignments.map(function (element) {\n      return element.getAttribute(\"product-id\");\n    })\n  );\n  return assignments;\n}\n\nfunction getParent(category) {\n  var parent = category.getElementsByTagName(\"parent\");\n  var parentID =\n    parent && Array.from(parent).length && Array.from(parent)[0].innerHTML;\n  return parentID;\n}\n\nfunction getRecords(id, xml) {\n  var productId = id;\n  var records = xml.getElementsByTagName(\"price-table\");\n  records = Array.from(records).filter(function (rec) {\n    return rec.getAttribute(\"product-id\") === productId;\n  });\n  return records;\n}\n\nfunction getRelatedAssets(asset, xml) {\n  var categoryId = getCategoryID(asset);\n\n  return evaluateXpath(\n    \"/*[local-name()='catalog']/*[local-name()='category']\",\n    xml\n  ).filter(function (cat) {\n    return getParent(cat) === categoryId;\n  });\n}\n\nfunction getCategoryID(asset) {\n  var catId = asset.getAttribute(\"category-id\");\n  return catId;\n}\n\nfunction getPDAssets(pageIDs, xml, fileName) {\n  const xmlEncoding = '<?xml version=\"1.0\" encoding=\"UTF-8\"?>\\n';\n  const libraryNode = xml.getElementsByTagName(\"pricebooks\")[0];\n  if (!libraryNode) {\n    addMessage(\n      `\"library\" node was not found in file \"${fileName}\". Please verify xml structure.`,\n      \"error\"\n    );\n    document.getElementById(\"app\").classList.remove(\"loading\");\n    return;\n  }\n  const library = libraryNode.cloneNode(true);\n  library.innerHTML = \"\";\n  let pageFound = false;\n  pageIDs.forEach((pageID) => {\n    let root = getRecords(pageID, xml);\n    if (root && root.length) {\n      let assets = root;\n      pageFound = true;\n      while (assets.length) {\n        let asset = assets.pop();\n        library.appendChild(document.createTextNode(\"\\n\\n    \"));\n        library.appendChild(asset);\n      }\n\n      library.appendChild(document.createTextNode(\"\\n\\n    \"));\n    } else {\n      addMessage(`Page \"${pageID}\" is not found. Skipping..`, \"warning\");\n    }\n  });\n  library.appendChild(document.createTextNode(\"\\n\\n\"));\n\n  if (pageFound) {\n    download(fileName, xmlEncoding + library.outerHTML);\n    addMessage(`Library xml is successfully filtered.`, \"success\");\n  } else {\n    addMessage(\"No pages found.\", \"error\");\n  }\n  document.getElementById(\"app\").classList.remove(\"loading\");\n}\n\nfunction download(filename, text) {\n  var element = document.createElement(\"a\");\n  element.setAttribute(\n    \"href\",\n    \"data:text/xml;charset=utf-8,\" + encodeURIComponent(text)\n  );\n  element.setAttribute(\"download\", filename);\n  element.setAttribute(\"target\", \"_blank\");\n\n  element.style.display = \"none\";\n  document.body.appendChild(element);\n\n  element.click();\n\n  document.body.removeChild(element);\n}\n\nfunction addMessage(message, type) {\n  var cssClass = \"\";\n  switch (type) {\n    case \"error\":\n      cssClass = \"error-msg\";\n      break;\n    case \"warning\":\n      cssClass = \"warning-msg\";\n      break;\n    case \"info\":\n      cssClass = \"info-msg\";\n      break;\n    case \"success\":\n      cssClass = \"success-msg\";\n      break;\n    default:\n      cssClass = \"success-msg\";\n      break;\n  }\n  var notification = document.createElement(\"div\");\n  notification.classList.add(cssClass);\n  notification.innerHTML = message;\n  document.getElementById(\"info-messages\").appendChild(notification);\n}\n"]}